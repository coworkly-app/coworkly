<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–µ —î —Å–≤—ñ—Ç–ª–æ? ‚ö°</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚ö°</text></svg>">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'media',
        }
    </script>
    
    <style>
        body { transition: background-color 0.3s, color 0.3s; }
        .bg-texture-light { background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%239C92AC' fill-opacity='0.12'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"); }
        .bg-texture-dark { background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"); }
        .modal-enter { opacity: 0; transform: scale(0.95); }
        .modal-enter-active { opacity: 1; transform: scale(1); transition: all 0.2s; }
    </style>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
        import { getFirestore, collection, setDoc, getDocs, query, orderBy, serverTimestamp, updateDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // --- ‚ö†Ô∏è –í–°–¢–ê–í –°–Æ–î–ò –°–í–û–á –î–ê–ù–Ü FIREBASE ‚ö†Ô∏è ---
        const firebaseConfig = {
            apiKey: "AIzaSyB098Rx6AOCdkjX7ZgX6Zk42uNDv8PXbXc",
            authDomain: "coworkly-3d04d.firebaseapp.com",
            projectId: "coworkly-3d04d",
            storageBucket: "coworkly-3d04d.firebasestorage.app",
            messagingSenderId: "685280227506",
            appId: "1:685280227506:web:9e31da685783f7948159ab",
            measurementId: "G-XNH7HV87L4"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);

        const cities = [
            "–ö–∏—ó–≤", "–•–∞—Ä–∫—ñ–≤", "–û–¥–µ—Å–∞", "–î–Ω—ñ–ø—Ä–æ", "–ó–∞–ø–æ—Ä—ñ–∂–∂—è", "–õ—å–≤—ñ–≤", "–ö—Ä–∏–≤–∏–π –†—ñ–≥", "–ú–∏–∫–æ–ª–∞—ó–≤", 
            "–í—ñ–Ω–Ω–∏—Ü—è", "–ü–æ–ª—Ç–∞–≤–∞", "–ß–µ—Ä–Ω—ñ–≥—ñ–≤", "–ß–µ—Ä–∫–∞—Å–∏", "–ñ–∏—Ç–æ–º–∏—Ä", "–°—É–º–∏", "–†—ñ–≤–Ω–µ", 
            "–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫", "–ö–∞–º'—è–Ω—Å—å–∫–µ", "–ö—Ä–æ–ø–∏–≤–Ω–∏—Ü—å–∫–∏–π", "–¢–µ—Ä–Ω–æ–ø—ñ–ª—å", "–õ—É—Ü—å–∫", 
            "–ë—ñ–ª–∞ –¶–µ—Ä–∫–≤–∞", "–ö—Ä–µ–º–µ–Ω—á—É–∫", "–ë—Ä–æ–≤–∞—Ä–∏", "–ü–∞–≤–ª–æ–≥—Ä–∞–¥", "–ú—É–∫–∞—á–µ–≤–æ", "–ö–æ–Ω–æ—Ç–æ–ø", "–£–º–∞–Ω—å", 
            "–û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ—è", "–î—Ä–æ–≥–æ–±–∏—á", "–ë–µ—Ä–¥–∏—á—ñ–≤", "–®–æ—Å—Ç–∫–∞", "–Ü–∑–º–∞—ó–ª", "–ù–æ–≤–æ–º–æ—Å–∫–æ–≤—Å—å–∫", 
            "–ö–æ–≤–µ–ª—å", "–ù—ñ–∂–∏–Ω", "–°–º—ñ–ª–∞", "–ö–∞–ª—É—à", "–ß–µ—Ä–≤–æ–Ω–æ–≥—Ä–∞–¥", "–ë–æ—Ä–∏—Å–ø—ñ–ª—å", "–ö–æ—Ä–æ—Å—Ç–µ–Ω—å", "–ö–æ–ª–æ–º–∏—è", "–Ü—Ä–ø—ñ–Ω—å"
        ].sort();

        const citySelects = ['searchCity', 'addCity'];
        citySelects.forEach(id => {
            const select = document.getElementById(id);
            if(select) {
                cities.forEach(city => {
                    const opt = document.createElement('option');
                    opt.value = city;
                    opt.textContent = city;
                    select.appendChild(opt);
                });
            }
        });

        function generateReadableId(city, name) {
            const map = {
                '–∞': 'a', '–±': 'b', '–≤': 'v', '–≥': 'h', '“ë': 'g', '–¥': 'd', '–µ': 'e', '—î': 'ye', '–∂': 'zh',
                '–∑': 'z', '–∏': 'y', '—ñ': 'i', '—ó': 'yi', '–π': 'y', '–∫': 'k', '–ª': 'l', '–º': 'm', '–Ω': 'n',
                '–æ': 'o', '–ø': 'p', '—Ä': 'r', '—Å': 's', '—Ç': 't', '—É': 'u', '—Ñ': 'f', '—Ö': 'kh', '—Ü': 'ts',
                '—á': 'ch', '—à': 'sh', '—â': 'shch', '—å': '', '—é': 'yu', '—è': 'ya', ' ': '-', '.': '', ',': ''
            };
            const text = `${city}-${name}`.toLowerCase();
            let result = '';
            for (let char of text) {
                result += map[char] || (/[a-z0-9-]/.test(char) ? char : '');
            }
            const random = Math.floor(Math.random() * 1000).toString();
            return `${result}-${random}`;
        }

        async function getCoordinatesFromAddress(city, address) {
            const query = `${address}, ${city}, Ukraine`;
            const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=1`;
            try {
                const response = await fetch(url, { headers: { 'User-Agent': 'Coworkly-App' } });
                const data = await response.json();
                if (data && data.length > 0) {
                    return { lat: parseFloat(data[0].lat), lng: parseFloat(data[0].lon) };
                }
            } catch (e) { console.warn("Geocoding failed:", e); }
            return null;
        }

        function getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {
            const R = 6371; 
            const dLat = (lat2-lat1) * (Math.PI/180);
            const dLon = (lon2-lon1) * (Math.PI/180);
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * (Math.PI/180)) * Math.cos(lat2 * (Math.PI/180)) * Math.sin(dLon/2) * Math.sin(dLon/2);
            return R * (2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)));
        }

        let userCoords = null;
        let addCoords = null; 
        let tempFormData = null;

        // --- –õ–û–ö–ê–¶–Ü–Ø ---
        window.requestUserLocation = () => {
            const statusDiv = document.getElementById('geoStatus');
            if(statusDiv) statusDiv.innerHTML = '<span class="text-blue-500 animate-pulse">–í–∏–∑–Ω–∞—á–∞—î–º–æ –≤—ñ–¥—Å—Ç–∞–Ω—å...</span>';
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        userCoords = { lat: position.coords.latitude, lng: position.coords.longitude };
                        if(statusDiv) statusDiv.innerHTML = '<span class="text-green-600 font-semibold">‚úÖ –õ–æ–∫–∞—Ü—ñ—é –≤–∏–∑–Ω–∞—á–µ–Ω–æ</span>';
                        loadLocations();
                    }, 
                    (error) => {
                        console.error("GPS Error:", error);
                        if(statusDiv) statusDiv.innerHTML = '<span class="text-red-500">‚ùå –î–æ—Å—Ç—É–ø –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ (–Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏)</span>'; 
                    },
                    { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
                );
            } else { 
                if(statusDiv) statusDiv.innerHTML = '<span class="text-red-500">‚ùå GPS –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è</span>';
            }
        }

        window.handleCityChange = () => {
            window.loadLocations();
        }

        // --- –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø ---
        async function loadLocations() {
            const listDiv = document.getElementById('locationsList');
            const cityFilter = document.getElementById('searchCity').value;
            if(listDiv) listDiv.innerHTML = '<p class="text-center dark:text-gray-400 mt-4">–û–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö...</p>';
            
            try {
                const q = query(collection(db, "locations"), orderBy("updated_at", "desc"));
                const querySnapshot = await getDocs(q);
                let locations = [];
                
                querySnapshot.forEach((docSnap) => {
                    const data = docSnap.data();
                    let dist = (userCoords && data.lat && data.lng) ? getDistanceFromLatLonInKm(userCoords.lat, userCoords.lng, data.lat, data.lng) : null;
                    locations.push({ id: docSnap.id, ...data, distance: dist });
                });

                if (cityFilter) locations = locations.filter(l => l.city === cityFilter);

                if (userCoords) {
                    locations.sort((a, b) => {
                        const distA = a.distance !== null ? a.distance : 99999;
                        const distB = b.distance !== null ? b.distance : 99999;
                        return distA - distB;
                    });
                }

                if(listDiv) {
                    listDiv.innerHTML = '';
                    if (locations.length === 0) {
                        listDiv.innerHTML = `<div class="text-center p-8 border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-xl mt-4 bg-white/50 dark:bg-gray-800/50"><h3 class="font-bold text-gray-700 dark:text-gray-300">–ü–æ–∫–∏ —â–æ –ø—É—Å—Ç–æ...</h3></div>`;
                        return;
                    }
                    locations.forEach((data) => {
                        const date = data.updated_at?.toDate().toLocaleString('uk-UA') || '–©–æ–π–Ω–æ';
                        const mapQuery = encodeURIComponent(`${data.city}, ${data.address}`);
                        const mapLink = `https://www.google.com/maps/search/?api=1&query=${mapQuery}`;
                        
                        let distBadge = '';
                        if (data.distance !== null) {
                            distBadge = `<span class="bg-blue-600 text-white px-2 py-0.5 rounded text-[10px] font-bold ml-2 shadow-sm">üìç ${data.distance.toFixed(1)} –∫–º</span>`;
                        }

                        // –Ø–°–ö–†–ê–í–Ü –ö–û–õ–¨–û–†–ò –°–¢–ê–¢–£–°–Ü–í
                        const powerBadge = data.has_power 
                            ? '<span class="bg-yellow-500 text-white shadow-md px-3 py-1 rounded-lg text-xs font-bold">‚ö° –Ñ —Å–≤—ñ—Ç–ª–æ</span>'
                            : '<span class="bg-gray-100 text-gray-400 px-2 py-1 rounded-lg text-xs font-bold">üí§ –ù–µ–º–∞—î</span>';
                            
                        const netBadge = data.has_internet 
                            ? '<span class="bg-blue-600 text-white shadow-md px-3 py-1 rounded-lg text-xs font-bold">üåê –Ñ —ñ–Ω–µ—Ç</span>'
                            : '<span class="bg-gray-100 text-gray-400 px-2 py-1 rounded-lg text-xs font-bold">üö´ –ù–µ–º–∞—î</span>';

                        const card = document.createElement('div');
                        card.className = "p-4 border border-gray-200 dark:border-gray-700 rounded-xl shadow-sm bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm mb-4";
                        card.innerHTML = `
                            <div class="flex justify-between items-start mb-2">
                                <div><h3 class="font-bold text-lg dark:text-white inline-block">${data.name}</h3>${distBadge}</div>
                                <span class="text-[10px] uppercase text-gray-400 text-right min-w-[70px]">–û–Ω–æ–≤–ª–µ–Ω–æ:<br>${date}</span>
                            </div>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">${data.city}, ${data.address}</p>
                            
                            <div class="flex gap-2 mb-3">
                                ${powerBadge}
                                ${netBadge}
                            </div>
                            
                            ${data.description ? `<p class="text-sm italic text-gray-500 mb-3 border-l-2 pl-2 border-gray-300">${data.description}</p>` : ''}
                            <div class="flex gap-2">
                                <button onclick="window.updateStatus('${data.id}')" class="flex-1 py-2 text-blue-600 dark:text-blue-400 text-xs font-bold border border-blue-100 dark:border-blue-900/50 rounded-lg active:bg-blue-50">–¶–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ ‚úÖ</button>
                                <a href="${mapLink}" target="_blank" class="flex-none px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded-lg text-xs font-bold flex items-center justify-center hover:bg-gray-200 transition">üó∫Ô∏è –ù–∞ –º–∞–ø—ñ</a>
                            </div>
                        `;
                        listDiv.appendChild(card);
                    });
                }
            } catch (e) { console.error(e); }
        }

        // --- –ü–Ü–î–ì–û–¢–û–í–ö–ê (–ú–û–î–ê–õ–ö–ê) ---
        window.openConfirmation = async () => {
            const btn = document.getElementById('preSaveBtn');
            const name = document.getElementById('addName').value;
            const city = document.getElementById('addCity').value;
            const addr = document.getElementById('addAddress').value;
            const desc = document.getElementById('addDesc').value;
            const hasPower = document.getElementById('hasPower').checked;
            const hasInternet = document.getElementById('hasInternet').checked;

            if(!name || !addr) return alert("–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –Ω–∞–∑–≤—É —Ç–∞ –∞–¥—Ä–µ—Å—É!");

            btn.disabled = true;
            btn.innerText = "–®—É–∫–∞—î–º–æ –∞–¥—Ä–µ—Å—É –Ω–∞ –∫–∞—Ä—Ç—ñ...";

            let geoStatusText = "‚ùå –ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ –Ω–∞ –∫–∞—Ä—Ç—ñ";
            let geoClass = "text-red-500";

            const autoCoords = await getCoordinatesFromAddress(city, addr);
            if (autoCoords) {
                addCoords = { ...autoCoords, method: 'auto' };
                geoStatusText = "‚úÖ –ó–Ω–∞–π–¥–µ–Ω–æ –Ω–∞ –∫–∞—Ä—Ç—ñ";
                geoClass = "text-green-600 font-bold";
            } else {
                addCoords = null;
            }

            tempFormData = { name, city, addr, desc, hasPower, hasInternet };

            document.getElementById('confName').innerText = name;
            document.getElementById('confAddress').innerText = `${city}, ${addr}`;
            document.getElementById('confGeo').innerHTML = `<span class="${geoClass}">${geoStatusText}</span>`;
            document.getElementById('confOpts').innerHTML = `
                ${hasPower ? '‚ö° –°–≤—ñ—Ç–ª–æ ' : ''} 
                ${hasInternet ? 'üåê –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç' : ''}
            `;

            document.getElementById('confirmModal').classList.remove('hidden');
            btn.disabled = false;
            btn.innerText = "–û–ü–£–ë–õ–Ü–ö–£–í–ê–¢–ò";
        };

        window.finalSave = async () => {
            if (!tempFormData) return;
            const confirmBtn = document.getElementById('confirmBtn');
            confirmBtn.disabled = true;
            confirmBtn.innerText = "–í—ñ–¥–ø—Ä–∞–≤–∫–∞...";

            try {
                const customId = generateReadableId(tempFormData.city, tempFormData.name);
                const docData = {
                    name: tempFormData.name,
                    city: tempFormData.city,
                    address: tempFormData.addr,
                    has_power: tempFormData.hasPower,
                    has_internet: tempFormData.hasInternet,
                    description: tempFormData.desc,
                    updated_at: serverTimestamp()
                };
                
                if (addCoords) { 
                    docData.lat = addCoords.lat; 
                    docData.lng = addCoords.lng; 
                }
                
                await setDoc(doc(db, "locations", customId), docData);
                location.reload(); 
            } catch (error) { 
                alert("–ü–æ–º–∏–ª–∫–∞: " + error.message); 
                confirmBtn.disabled = false; 
                confirmBtn.innerText = "–í—Å–µ –≤—ñ—Ä–Ω–æ, –ø—É–±–ª—ñ–∫—É—î–º–æ";
            }
        };

        window.closeModal = () => { document.getElementById('confirmModal').classList.add('hidden'); };
        
        // –§—É–Ω–∫—Ü—ñ—ó –¥–ª—è –º–æ–¥–∞–ª–∫–∏ –ø—Ä–∞–≤–∏–ª
        window.openRules = () => { document.getElementById('rulesModal').classList.remove('hidden'); };
        window.closeRules = () => { document.getElementById('rulesModal').classList.add('hidden'); };

        window.updateStatus = async (id) => {
            await updateDoc(doc(db, "locations", id), { updated_at: serverTimestamp() });
            loadLocations();
        };

        window.loadLocations = loadLocations;
        window.requestUserLocation = requestUserLocation;
        window.handleCityChange = handleCityChange;

        loadLocations();

    </script>
</head>
<body class="bg-gray-50 dark:bg-gray-900 bg-texture-light dark:bg-texture-dark min-h-screen font-sans text-gray-900 dark:text-gray-100">
    
    <nav class="bg-blue-600 dark:bg-blue-800 text-white shadow-lg sticky top-0 z-20">
        <div class="max-w-md mx-auto p-4 flex justify-between items-center">
            <h1 class="text-xl font-black">Cowork‚Ä¢Ly ‚ö°</h1>
            <button onclick="window.openRules()" class="text-white bg-white/20 hover:bg-white/30 px-3 py-1.5 rounded-lg text-sm font-bold transition">‚ÑπÔ∏è –ü—Ä–∞–≤–∏–ª–∞</button>
        </div>
    </nav>

    <div class="max-w-md mx-auto p-4">
        <div class="flex mb-6 bg-white dark:bg-gray-800 rounded-xl p-1 shadow-inner border border-gray-100 dark:border-gray-700">
            <button onclick="showTab('find')" id="tabFind" class="flex-1 py-2.5 rounded-lg bg-blue-600 text-white font-bold transition-all shadow-md">–ó–Ω–∞–π—Ç–∏</button>
            <button onclick="showTab('add')" id="tabAdd" class="flex-1 py-2.5 rounded-lg text-gray-500 font-bold">–î–æ–¥–∞—Ç–∏</button>
        </div>
        
        <div id="sectionFind" class="space-y-4">
            <div class="bg-white/90 dark:bg-gray-800/90 p-4 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
                <div class="flex gap-2 mb-2">
                    <select id="searchCity" onchange="window.handleCityChange()" class="flex-1 p-3 bg-gray-50 dark:bg-gray-700 border border-gray-200 rounded-xl outline-none dark:text-white">
                        <option value="" disabled selected>–û–±–µ—Ä—ñ—Ç—å –º—ñ—Å—Ç–æ...</option>
                    </select>
                    <button onclick="window.requestUserLocation()" class="bg-green-600 text-white p-3 rounded-xl border border-green-700 shadow-md text-2xl hover:bg-green-700 transition-all active:scale-95" title="–ó–Ω–∞–π—Ç–∏ –ø–æ—Ä—É—á">üìç</button>
                </div>
                <div id="geoStatus" class="text-[10px] text-center h-4"></div>
            </div>
            <div id="locationsList"></div>
        </div>

        <div id="sectionAdd" class="hidden bg-white/90 dark:bg-gray-800/90 p-5 border border-gray-200 dark:border-gray-700 rounded-2xl shadow-xl">
            <h2 class="text-xl font-bold mb-5 text-center">–î–æ–¥–∞—Ç–∏ –∫–æ–≤–æ—Ä–∫—ñ–Ω–≥</h2>
            <div class="space-y-4">
                <input type="text" id="addName" placeholder="–ù–∞–∑–≤–∞ –∑–∞–∫–ª–∞–¥—É" class="w-full p-3 bg-gray-50 dark:bg-gray-700 border border-gray-200 rounded-xl outline-none dark:text-white">
                <select id="addCity" class="w-full p-3 bg-gray-50 dark:bg-gray-700 border border-gray-200 rounded-xl dark:text-white"></select>
                <input type="text" id="addAddress" placeholder="–ê–¥—Ä–µ—Å–∞ (–Ω–∞–ø—Ä. –≤—É–ª. –°–æ–±–æ—Ä–Ω–∞ 5)" class="w-full p-3 bg-gray-50 dark:bg-gray-700 border border-gray-200 rounded-xl dark:text-white">
                
                <div class="flex gap-4 py-2">
                    <label class="flex items-center gap-2 cursor-pointer"><input type="checkbox" id="hasPower" class="w-5 h-5 rounded text-yellow-500"><span>–°–≤—ñ—Ç–ª–æ</span></label>
                    <label class="flex items-center gap-2 cursor-pointer"><input type="checkbox" id="hasInternet" class="w-5 h-5 rounded text-blue-500"><span>–Ü–Ω–µ—Ç</span></label>
                </div>
                <textarea id="addDesc" rows="2" placeholder="–£–º–æ–≤–∏ (—á–∞—Å–∏ —Ä–æ–±–æ—Ç–∏ –∑–∞–∫–ª–∞–¥—É, —Ü—ñ–Ω–∞ –¥–ª—è –∫–æ–≤–æ—Ä–∫–∏–Ω–≥—É, —Ç–µ–ª–µ—Ñ–æ–Ω, —Ç–æ–π—â–æ)" class="w-full p-3 bg-gray-50 dark:bg-gray-700 border border-gray-200 rounded-xl outline-none dark:text-white"></textarea>
                <button id="preSaveBtn" onclick="window.openConfirmation()" class="w-full bg-green-600 text-white py-4 rounded-xl font-black text-lg shadow-lg">–û–ü–£–ë–õ–Ü–ö–£–í–ê–¢–ò</button>
            </div>
        </div>
    </div>

    <div id="confirmModal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm modal-enter-active">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 max-w-sm w-full shadow-2xl border border-gray-200 dark:border-gray-700">
            <h3 class="text-xl font-bold mb-4 text-center dark:text-white">–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –¥–∞–Ω—ñ</h3>
            <div class="space-y-3 text-sm mb-6">
                <div class="bg-gray-50 dark:bg-gray-700/50 p-3 rounded-xl">
                    <p class="text-xs text-gray-500 dark:text-gray-400">–ù–∞–∑–≤–∞:</p>
                    <p class="font-bold text-lg dark:text-white" id="confName"></p>
                </div>
                <div>
                    <p class="text-xs text-gray-500 dark:text-gray-400">–ê–¥—Ä–µ—Å–∞:</p>
                    <p class="font-medium dark:text-gray-200" id="confAddress"></p>
                </div>
                <div>
                    <p class="text-xs text-gray-500 dark:text-gray-400">–ì–µ–æ–ª–æ–∫–∞—Ü—ñ—è:</p>
                    <p class="font-medium" id="confGeo"></p>
                </div>
                <div>
                    <p class="text-xs text-gray-500 dark:text-gray-400">–û–ø—Ü—ñ—ó:</p>
                    <p class="font-medium dark:text-gray-200" id="confOpts"></p>
                </div>
            </div>
            <div class="flex gap-3">
                <button onclick="window.closeModal()" class="flex-1 py-3 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 font-bold rounded-xl">–í—ñ–¥–º—ñ–Ω–∞</button>
                <button id="confirmBtn" onclick="window.finalSave()" class="flex-1 py-3 bg-green-600 text-white font-bold rounded-xl shadow-lg">–í—Å–µ –≤—ñ—Ä–Ω–æ</button>
            </div>
        </div>
    </div>

    <div id="rulesModal" class="hidden fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm modal-enter-active" onclick="window.closeRules()">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 max-w-sm w-full shadow-2xl border border-gray-200 dark:border-gray-700 relative" onclick="event.stopPropagation()">
            <button onclick="window.closeRules()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">‚úï</button>
            
            <h3 class="text-xl font-black mb-2 text-center dark:text-white">–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î?</h3>
            
            <p class="text-sm text-gray-500 dark:text-gray-400 text-center mb-4 italic">
                –¶–µ–π —Å–µ—Ä–≤—ñ—Å —Å—Ç–≤–æ—Ä–µ–Ω–æ –¥–ª—è –≤–∑–∞—î–º–æ–¥–æ–ø–æ–º–æ–≥–∏: —à—É–∫–∞–π—Ç–µ, –¥–µ —î —Å–≤—ñ—Ç–ª–æ, —Ç–∞ –¥—ñ–ª—ñ—Ç—å—Å—è –≤–ª–∞—Å–Ω–∏–º–∏ –∑–Ω–∞—Ö—ñ–¥–∫–∞–º–∏.
            </p>
            
            <div class="space-y-4 text-sm text-gray-600 dark:text-gray-300">
                <div>
                    <h4 class="font-bold text-blue-600 dark:text-blue-400 mb-1 flex items-center gap-2">üîç –†–æ–∑–¥—ñ–ª "–ó–Ω–∞–π—Ç–∏" (—Ç–æ–π —Ö—Ç–æ —à—É–∫–∞—î)</h4>
                    <ul class="list-disc pl-5 space-y-1">
                        <li>–û–±–µ—Ä—ñ—Ç—å —Å–≤–æ—î –º—ñ—Å—Ç–æ –∑—ñ —Å–ø–∏—Å–∫—É.</li>
                        <li>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å <span class="text-green-600 font-bold">üìç</span>, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ –∑–∞–∫–ª–∞–¥–∏ –ø–æ—Ä—É—á (—Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –∑–∞ –≤—ñ–¥—Å—Ç–∞–Ω–Ω—é).</li>
                        <li>–¢–∏—Å–Ω—ñ—Ç—å <b>"–ù–∞ –º–∞–ø—ñ"</b>, —â–æ–± –≤—ñ–¥–∫—Ä–∏—Ç–∏ –∫–∞—Ä—Ç—É –∑ –∞–¥—Ä–µ—Å–æ—é.</li>
                        <li>–¢–∏—Å–Ω—ñ—Ç—å <b>"–¶–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ"</b>, —è–∫—â–æ –¥–∞–Ω—ñ –ø—Ä–∞–≤–¥–∏–≤—ñ.</li>
                    </ul>
                </div>
                
                <hr class="border-gray-200 dark:border-gray-700">

                <div>
                    <h4 class="font-bold text-green-600 dark:text-green-400 mb-1 flex items-center gap-2">‚ûï –†–æ–∑–¥—ñ–ª "–î–æ–¥–∞—Ç–∏" (—Ç–æ–π —Ö—Ç–æ –Ω–∞–¥–∞—î)</h4>
                    <ul class="list-disc pl-5 space-y-1">
                        <li>–í–ø–∏—à—ñ—Ç—å –Ω–∞–∑–≤—É —Ç–∞ <b>—Ç–æ—á–Ω—É –∞–¥—Ä–µ—Å—É</b> (–≤—É–ª–∏—Ü—è, –Ω–æ–º–µ—Ä).</li>
                        <li>–°–∏—Å—Ç–µ–º–∞ <b>–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ</b> –∑–Ω–∞–π–¥–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –Ω–∞ –º–∞–ø—ñ.</li>
                        <li>–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –¥–∞–Ω—ñ —É –≤—ñ–∫–Ω—ñ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è —Ç–∞ –ø—É–±–ª—ñ–∫—É–π—Ç–µ!</li>
                    </ul>

                    <div class="mt-3 bg-yellow-50 dark:bg-yellow-900/30 border-l-4 border-yellow-400 p-3 rounded-r-lg">
                        <ul class="list-disc pl-4 space-y-1 text-xs text-gray-700 dark:text-gray-300">
                            <li>–õ–æ–∫–∞—Ü—ñ—ó –º–æ–∂—É—Ç—å –¥–æ–¥–∞–≤–∞—Ç–∏ –≤—Å—ñ –±–∞–∂–∞—é—á—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ.</li>
                            <li>–õ–æ–∫–∞—Ü—ñ—ó –º–æ–∂—É—Ç—å –ø–æ–≤—Ç–æ—Ä—é–≤–∞—Ç–∏—Å—å.</li>
                            <li>–ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω—ñ—Å—Ç—å –∑–∞–∫–ª–∞–¥—É –Ω–∞ –º–∞–ø—ñ.</li>
                            <li>–ó–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –∫–æ–Ω—Ç–∞–∫—Ç–Ω–∏—Ö –¥–∞–Ω–∏—Ö –≤ –æ–ø–∏—Å—ñ –∑–≤ º—è–∂—ñ—Ç—å—Å—è –∑ –∑–∞–∫–ª–∞–¥–æ–º –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó.</li>
                        </ul>
                    </div>

                </div>
            </div>

            <button onclick="window.closeRules()" class="w-full mt-6 py-3 bg-blue-600 text-white font-bold rounded-xl shadow-lg hover:bg-blue-700 transition">–ó—Ä–æ–∑—É–º—ñ–ª–æ!</button>
        </div>
    </div>

    <script>
        function showTab(tab) {
            const find = document.getElementById('sectionFind'), add = document.getElementById('sectionAdd');
            const tF = document.getElementById('tabFind'), tA = document.getElementById('tabAdd');
            if (tab === 'find') {
                find.classList.remove('hidden'); add.classList.add('hidden');
                tF.className = "flex-1 py-2.5 rounded-lg bg-blue-600 text-white font-bold shadow-md";
                tA.className = "flex-1 py-2.5 rounded-lg text-gray-500 font-bold";
            } else {
                find.classList.add('hidden'); add.classList.remove('hidden');
                tA.className = "flex-1 py-2.5 rounded-lg bg-green-600 text-white font-bold shadow-md";
                tF.className = "flex-1 py-2.5 rounded-lg text-gray-500 font-bold";
            }
        }
    </script>
</body>
</html>
